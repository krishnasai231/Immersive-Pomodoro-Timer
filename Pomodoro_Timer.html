<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Immersive Pomodoro Timer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --focus-ring: #FF6B6B;
            --break-ring: #4ECDC4;
            --long-break-ring: #9B59B6;
            --text-primary: #1a1a1a;
            --text-light: #ffffff;
            --bg-dark: rgba(20, 20, 30, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: #1a1a2e;
            color: var(--text-primary);
            height: 100vh;
        }

        /* BACKGROUND SCENES */
        .scene-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            transition: opacity 0.8s ease;
            opacity: 1;
        }

        .scene-container.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Rain Scene */
        .rain-scene {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            position: relative;
            overflow: hidden;
        }

        .rain-drops {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: repeating-linear-gradient(
                90deg,
                transparent,
                transparent 2px,
                rgba(255, 255, 255, 0.3) 2px,
                rgba(255, 255, 255, 0.3) 4px
            );
            animation: rain-fall 0.3s linear infinite;
        }

        @keyframes rain-fall {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }

        .rain-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
        }

        /* Forest Scene */
        .forest-scene {
            background: linear-gradient(180deg, #667eea 0%, #764ba2 50%, #2d5a3d 100%);
            position: relative;
        }

        .tree {
            position: absolute;
            bottom: 0;
            width: 80px;
            height: 200px;
            opacity: 0.8;
        }

        .tree:nth-child(1) { left: 10%; animation: sway 4s ease-in-out infinite; }
        .tree:nth-child(2) { left: 30%; animation: sway 5s ease-in-out infinite 0.5s; }
        .tree:nth-child(3) { left: 50%; animation: sway 4.5s ease-in-out infinite 1s; }
        .tree:nth-child(4) { left: 70%; animation: sway 5.5s ease-in-out infinite 0.3s; }
        .tree:nth-child(5) { right: 10%; animation: sway 4.2s ease-in-out infinite 0.7s; }

        .tree::before {
            content: '';
            position: absolute;
            top: 20%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-bottom: 40px solid #2d5a3d;
        }

        .tree::after {
            content: '';
            position: absolute;
            top: 35%;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 50px solid #2d5a3d;
        }

        .firefly {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffeb3b;
            border-radius: 50%;
            box-shadow: 0 0 10px #ffeb3b;
            animation: firefly-float 6s ease-in-out infinite;
        }

        .firefly:nth-child(6) { left: 20%; top: 30%; animation-delay: 0s; }
        .firefly:nth-child(7) { left: 40%; top: 50%; animation-delay: 1s; }
        .firefly:nth-child(8) { left: 70%; top: 40%; animation-delay: 2s; }
        .firefly:nth-child(9) { right: 20%; top: 60%; animation-delay: 1.5s; }

        @keyframes sway {
            0%, 100% { transform: rotateZ(-2deg); }
            50% { transform: rotateZ(2deg); }
        }

        @keyframes firefly-float {
            0%, 100% { transform: translate(0, 0); opacity: 0.5; }
            50% { transform: translate(30px, -30px); opacity: 1; }
        }

        /* Ocean Scene */
        .ocean-scene {
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 50%, #7cb9e8 100%);
            position: relative;
        }

        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 120'%3E%3Cpath d='M0,50 Q300,0 600,50 T1200,50' stroke='%23ffffff' stroke-width='2' fill='none' opacity='0.3'/%3E%3C/svg%3E");
            background-size: 300px;
            animation: wave-move 15s linear infinite;
        }

        .wave:nth-child(1) { bottom: 10%; opacity: 0.7; animation: wave-move 15s linear infinite; }
        .wave:nth-child(2) { bottom: 15%; opacity: 0.4; animation: wave-move 20s linear infinite reverse; }

        @keyframes wave-move {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        .sun {
            position: absolute;
            top: 20%;
            right: 15%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, #ffeb3b, #ffc107);
            border-radius: 50%;
            box-shadow: 0 0 60px rgba(255, 235, 59, 0.4);
        }

        /* Cafe Scene */
        .cafe-scene {
            background: linear-gradient(135deg, #8b6f47 0%, #a89070 100%);
            position: relative;
            overflow: hidden;
        }

        .bokeh {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 200, 100, 0.3), transparent);
            animation: bokeh-float 8s ease-in-out infinite;
        }

        .bokeh:nth-child(1) { width: 150px; height: 150px; left: 10%; top: 20%; animation-delay: 0s; }
        .bokeh:nth-child(2) { width: 200px; height: 200px; right: 15%; top: 40%; animation-delay: 2s; }
        .bokeh:nth-child(3) { width: 100px; height: 100px; left: 40%; bottom: 20%; animation-delay: 4s; }
        .bokeh:nth-child(4) { width: 180px; height: 180px; right: 30%; bottom: 10%; animation-delay: 1s; }

        @keyframes bokeh-float {
            0%, 100% { transform: translate(0, 0); }
            50% { transform: translate(20px, 20px); }
        }

        .cafe-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                0deg,
                rgba(0, 0, 0, 0.03) 0px,
                rgba(0, 0, 0, 0.03) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
        }

        /* Space Scene */
        .space-scene {
            background: radial-gradient(ellipse at center, #0a0e27 0%, #000000 100%);
            position: relative;
            overflow: hidden;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
        }

        .star {
            position: absolute;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .nebula {
            position: absolute;
            border-radius: 50%;
            animation: nebula-rotate 20s linear infinite;
        }

        .nebula:nth-child(1) {
            width: 600px;
            height: 600px;
            top: -100px;
            right: -200px;
            background: radial-gradient(circle, rgba(255, 0, 127, 0.2), transparent);
        }

        .nebula:nth-child(2) {
            width: 500px;
            height: 500px;
            bottom: -100px;
            left: -100px;
            background: radial-gradient(circle, rgba(0, 255, 127, 0.2), transparent);
        }

        @keyframes nebula-rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* MAIN CONTAINER */
        .container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
            pointer-events: none;
        }

        .container > * {
            pointer-events: auto;
        }

        /* TIMER CARD */
        .timer-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 40px;
            padding: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: breathe 3s ease-in-out infinite;
            transition: all 0.3s ease;
        }

        @keyframes breathe {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .session-label {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-light);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.9;
        }

        /* CIRCULAR TIMER */
        .timer-circle {
            position: relative;
            width: 300px;
            height: 300px;
            margin-bottom: 40px;
        }

        svg {
            width: 100%;
            height: 100%;
            filter: drop-shadow(0 0 30px rgba(255, 255, 255, 0.1));
        }

        .progress-ring {
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }

        .progress-ring-circle {
            stroke: var(--focus-ring);
            fill: transparent;
            stroke-linecap: round;
            stroke-width: 8;
            transition: stroke 0.3s ease;
            animation: ring-pulse 0.3s ease;
        }

        @keyframes ring-pulse {
            0% { stroke-width: 8; }
            50% { stroke-width: 10; }
            100% { stroke-width: 8; }
        }

        .timer-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: var(--text-light);
            font-size: 80px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            letter-spacing: -2px;
        }

        /* CONTROLS */
        .controls {
            display: flex;
            gap: 30px;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }

        button {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-light);
            font-size: 24px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        button:active {
            transform: translateY(-1px);
        }

        .btn-play {
            width: 80px;
            height: 80px;
            font-size: 32px;
            background: linear-gradient(135deg, var(--focus-ring), #ff8c42);
            border: none;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .btn-play:hover {
            box-shadow: 0 12px 35px rgba(255, 107, 107, 0.6);
            transform: translateY(-5px);
        }

        /* SCENE SELECTOR */
        .scene-selector {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 20;
        }

        .scene-btn {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--glass-bg);
            border: 2px solid var(--glass-border);
            cursor: pointer;
            font-size: 20px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .scene-btn:hover,
        .scene-btn.active {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        /* SETTINGS PANEL */
        .settings-panel {
            position: fixed;
            right: 0;
            top: 0;
            width: 350px;
            height: 100%;
            background: var(--bg-dark);
            border-left: 1px solid var(--glass-border);
            backdrop-filter: blur(20px);
            padding: 30px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 30;
            overflow-y: auto;
        }

        .settings-panel.open {
            transform: translateX(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            color: var(--text-light);
        }

        .settings-header h2 {
            font-size: 24px;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-light);
            font-size: 24px;
            cursor: pointer;
            width: auto;
            height: auto;
            padding: 5px;
            transition: all 0.2s ease;
            box-shadow: none;
        }

        .close-btn:hover {
            transform: rotate(90deg);
        }

        .setting-group {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .setting-group:last-child {
            border-bottom: none;
        }

        .setting-label {
            color: var(--text-light);
            font-weight: 600;
            margin-bottom: 12px;
            display: block;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .setting-input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-light);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .setting-input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.4);
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        input[type="range"] {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--focus-ring);
            cursor: pointer;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--focus-ring);
            cursor: pointer;
            border: none;
            box-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        .volume-value {
            color: var(--text-light);
            min-width: 40px;
            text-align: right;
            font-size: 14px;
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .toggle-label {
            flex: 1;
            color: var(--text-light);
            font-size: 14px;
        }

        .toggle {
            width: 50px;
            height: 26px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 13px;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .toggle.active {
            background: var(--focus-ring);
            border-color: var(--focus-ring);
        }

        .toggle::after {
            content: '';
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 1px;
            left: 2px;
            transition: all 0.3s ease;
        }

        .toggle.active::after {
            left: 25px;
        }

        /* NOTIFICATIONS */
        .notification {
            position: fixed;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            padding: 20px 30px;
            border-radius: 12px;
            color: var(--text-light);
            font-size: 16px;
            animation: slide-down 0.3s ease;
            z-index: 40;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        @keyframes slide-down {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 50;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .modal.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: var(--bg-dark);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            color: var(--text-light);
            max-width: 400px;
            animation: modal-pop 0.3s ease;
        }

        @keyframes modal-pop {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .modal-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 20px;
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--focus-ring) !important;
            border: none !important;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.4) !important;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1) !important;
            border: 1px solid rgba(255, 255, 255, 0.2) !important;
        }

        /* TASK INPUT */
        .task-input {
            position: fixed;
            top: 30px;
            left: 30px;
            max-width: 300px;
            z-index: 20;
        }

        .task-input input {
            width: 100%;
            padding: 12px 16px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--text-light);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .task-input input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .task-input input:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.4);
        }

        /* SETTINGS BUTTON */
        .settings-btn {
            position: fixed;
            top: 30px;
            right: 30px;
            z-index: 25;
        }

        /* SESSION COUNTER */
        .session-counter {
            position: fixed;
            bottom: 40px;
            right: 40px;
            color: var(--text-light);
            text-align: center;
            z-index: 20;
        }

        .tomato-counter {
            font-size: 32px;
            margin-bottom: 8px;
            letter-spacing: 4px;
        }

        .counter-label {
            font-size: 12px;
            opacity: 0.7;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .timer-card {
                padding: 40px 30px;
            }

            .timer-circle {
                width: 200px;
                height: 200px;
                margin-bottom: 30px;
            }

            .timer-text {
                font-size: 54px;
            }

            .btn-play {
                width: 70px;
                height: 70px;
                font-size: 28px;
            }

            .scene-selector {
                flex-wrap: wrap;
                max-width: 80%;
                justify-content: center;
            }

            .settings-panel {
                width: 100%;
                max-width: 300px;
            }

            .task-input input {
                max-width: 80vw;
            }
        }
    </style>
</head>
<body>
    <!-- SCENE CONTAINERS -->
    <div class="scene-container" id="rainScene">
        <div class="rain-scene">
            <div class="rain-drops"></div>
            <div class="rain-overlay"></div>
        </div>
    </div>

    <div class="scene-container hidden" id="forestScene">
        <div class="forest-scene">
            <div class="tree"></div>
            <div class="tree"></div>
            <div class="tree"></div>
            <div class="tree"></div>
            <div class="tree"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
            <div class="firefly"></div>
        </div>
    </div>

    <div class="scene-container hidden" id="oceanScene">
        <div class="ocean-scene">
            <div class="sun"></div>
            <div class="wave"></div>
            <div class="wave"></div>
        </div>
    </div>

    <div class="scene-container hidden" id="cafeScene">
        <div class="cafe-scene">
            <div class="bokeh"></div>
            <div class="bokeh"></div>
            <div class="bokeh"></div>
            <div class="bokeh"></div>
            <div class="cafe-overlay"></div>
        </div>
    </div>

    <div class="scene-container hidden" id="spaceScene">
        <div class="space-scene">
            <div class="stars" id="starsContainer"></div>
            <div class="nebula"></div>
            <div class="nebula"></div>
        </div>
    </div>

    <!-- MAIN CONTAINER -->
    <div class="container">
        <!-- TASK INPUT -->
        <div class="task-input">
            <input type="text" id="taskInput" placeholder="What are you working on?" maxlength="50">
        </div>

        <!-- SETTINGS BUTTON -->
        <button class="settings-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>

        <!-- TIMER CARD -->
        <div class="timer-card">
            <div class="session-label" id="sessionLabel">Focus Session</div>
            
            <div class="timer-circle">
                <svg class="progress-ring" viewBox="0 0 100 100">
                    <circle class="progress-ring-circle" stroke-dasharray="282.6 282.6" r="45" cx="50" cy="50"></circle>
                </svg>
                <div class="timer-text" id="timerDisplay">25:00</div>
            </div>

            <div class="controls">
                <button id="resetBtn" title="Reset">‚Üª</button>
                <button class="btn-play" id="playPauseBtn" title="Play">‚ñ∂</button>
            </div>
        </div>

        <!-- SCENE SELECTOR -->
        <div class="scene-selector">
            <button class="scene-btn active" data-scene="rain" title="Rain">üåßÔ∏è</button>
            <button class="scene-btn" data-scene="forest" title="Forest">üå≤</button>
            <button class="scene-btn" data-scene="ocean" title="Ocean">üåä</button>
            <button class="scene-btn" data-scene="cafe" title="Cafe">‚òï</button>
            <button class="scene-btn" data-scene="space" title="Space">üåå</button>
        </div>

        <!-- SESSION COUNTER -->
        <div class="session-counter">
            <div class="tomato-counter" id="tomatoCounter">üçÖ</div>
            <div class="counter-label">sessions</div>
        </div>
    </div>

    <!-- SETTINGS PANEL -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h2>Settings</h2>
            <button class="close-btn" id="closeSettings">‚úï</button>
        </div>

        <div class="setting-group">
            <label class="setting-label">Focus Duration (minutes)</label>
            <input type="number" id="focusDuration" class="setting-input" min="1" max="60" value="25">
        </div>

        <div class="setting-group">
            <label class="setting-label">Short Break (minutes)</label>
            <input type="number" id="breakDuration" class="setting-input" min="1" max="30" value="5">
        </div>

        <div class="setting-group">
            <label class="setting-label">Long Break (minutes)</label>
            <input type="number" id="longBreakDuration" class="setting-input" min="1" max="60" value="15">
        </div>

        <div class="setting-group">
            <label class="setting-label">Volume</label>
            <div class="slider-container">
                <span>üîá</span>
                <input type="range" id="volumeSlider" min="0" max="100" value="70">
                <span class="volume-value" id="volumeValue">70%</span>
            </div>
        </div>

        <div class="setting-group">
            <label class="toggle-switch" id="autoStartToggle">
                <span class="toggle-label">Auto-start Next Session</span>
                <div class="toggle"></div>
            </label>
        </div>

        <div class="setting-group">
            <label class="toggle-switch" id="notificationToggle">
                <span class="toggle-label">Notifications</span>
                <div class="toggle active"></div>
            </label>
        </div>

        <div class="setting-group">
            <label class="toggle-switch" id="soundToggle">
                <span class="toggle-label">Notification Sound</span>
                <div class="toggle active"></div>
            </label>
        </div>
    </div>

    <!-- MODAL -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-title" id="modalTitle">Time for a break!</div>
            <p id="modalMessage">Great work! Take a moment to rest.</p>
            <div class="modal-buttons">
                <button class="btn-secondary" id="skipBtn">Skip</button>
                <button class="btn-primary" id="continueBtn">Continue</button>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div class="notification" id="notification"></div>

    <script>
        // STAR GENERATOR FOR SPACE SCENE
        function generateStars() {
            const starsContainer = document.getElementById('starsContainer');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                star.style.opacity = Math.random() * 0.7 + 0.3;
                starsContainer.appendChild(star);
            }
        }
        generateStars();

        // TIMER STATE
        const timerState = {
            timeLeft: 25 * 60,
            totalTime: 25 * 60,
            isRunning: false,
            isBreak: false,
            isLongBreak: false,
            sessionsCompleted: 0,
            currentScene: 'rain',
            timerInterval: null,
            focusDuration: 25,
            breakDuration: 5,
            longBreakDuration: 15,
            volume: 0.7,
            autoStart: false,
            notificationsEnabled: true,
            soundEnabled: true
        };

        // DOM ELEMENTS
        const timerDisplay = document.getElementById('timerDisplay');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const resetBtn = document.getElementById('resetBtn');
        const sessionLabel = document.getElementById('sessionLabel');
        const progressRingCircle = document.querySelector('.progress-ring-circle');
        const modal = document.getElementById('modal');
        const notification = document.getElementById('notification');
        const timerCard = document.querySelector('.timer-card');
        const sceneButtons = document.querySelectorAll('.scene-btn');
        const tomatoCounter = document.getElementById('tomatoCounter');

        // SETTINGS ELEMENTS
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const closeSettingsBtn = document.getElementById('closeSettings');
        const focusDurationInput = document.getElementById('focusDuration');
        const breakDurationInput = document.getElementById('breakDuration');
        const longBreakDurationInput = document.getElementById('longBreakDuration');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeValue = document.getElementById('volumeValue');
        const autoStartToggle = document.getElementById('autoStartToggle');
        const notificationToggle = document.getElementById('notificationToggle');
        const soundToggle = document.getElementById('soundToggle');

        // CONSTANTS
        const CIRCUMFERENCE = 282.6;
        const RING_COLORS = {
            focus: '#FF6B6B',
            break: '#4ECDC4',
            longBreak: '#9B59B6'
        };

        // FORMAT TIME DISPLAY
        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // UPDATE TIMER DISPLAY
        function updateDisplay() {
            timerDisplay.textContent = formatTime(timerState.timeLeft);
            updateProgressRing();
        }

        // UPDATE PROGRESS RING
        function updateProgressRing() {
            const progress = (timerState.timeLeft / timerState.totalTime) * 100;
            const offset = CIRCUMFERENCE - (progress / 100) * CIRCUMFERENCE;
            progressRingCircle.style.strokeDashoffset = offset;

            // Update ring color based on session type
            const color = timerState.isLongBreak ? RING_COLORS.longBreak : 
                         timerState.isBreak ? RING_COLORS.break : 
                         RING_COLORS.focus;
            progressRingCircle.style.stroke = color;
        }

        // PLAY/PAUSE TIMER
        function toggleTimer() {
            if (timerState.isRunning) {
                pauseTimer();
            } else {
                startTimer();
            }
        }

        function startTimer() {
            timerState.isRunning = true;
            playPauseBtn.textContent = '‚è∏';
            playPauseBtn.style.background = 'linear-gradient(135deg, #ff8c42, #ff6b6b)';

            timerInterval = setInterval(() => {
                timerState.timeLeft--;
                updateDisplay();

                if (timerState.timeLeft === 0) {
                    completeSession();
                }
            }, 1000);
        }

        function pauseTimer() {
            timerState.isRunning = false;
            playPauseBtn.textContent = '‚ñ∂';
            playPauseBtn.style.background = 'linear-gradient(135deg, #ff6b6b, #ff8c42)';
            clearInterval(timerInterval);
        }

        // RESET TIMER
        function resetTimer() {
            pauseTimer();
            const duration = timerState.isLongBreak ? timerState.longBreakDuration :
                           timerState.isBreak ? timerState.breakDuration :
                           timerState.focusDuration;
            timerState.timeLeft = duration * 60;
            timerState.totalTime = duration * 60;
            updateDisplay();
            showNotification('Timer reset');
        }

        // COMPLETE SESSION
        function completeSession() {
            pauseTimer();
            playCompletionAnimation();

            if (!timerState.isBreak && !timerState.isLongBreak) {
                // Session completed
                timerState.sessionsCompleted++;
                updateTomatoCounter();

                // Determine next session
                const isLongBreakTime = timerState.sessionsCompleted % 4 === 0;
                timerState.isBreak = true;
                timerState.isLongBreak = isLongBreakTime;

                const duration = isLongBreakTime ? timerState.longBreakDuration : timerState.breakDuration;
                timerState.timeLeft = duration * 60;
                timerState.totalTime = duration * 60;

                showModal(
                    isLongBreakTime ? 'Time for a long break!' : 'Time for a short break!',
                    isLongBreakTime ? 
                    'You\'ve completed 4 sessions! Take a longer break to recharge.' :
                    'Great work! Take a short break to refresh.'
                );
            } else {
                // Break completed
                timerState.isBreak = false;
                timerState.isLongBreak = false;
                timerState.timeLeft = timerState.focusDuration * 60;
                timerState.totalTime = timerState.focusDuration * 60;

                showModal('Back to focus!', 'Ready for another productive session?');
            }

            updateSessionLabel();
            updateDisplay();

            if (timerState.autoStart) {
                setTimeout(startTimer, 2000);
            }
        }

        // PLAY COMPLETION ANIMATION
        function playCompletionAnimation() {
            progressRingCircle.style.animation = 'none';
            void progressRingCircle.offsetWidth; // Trigger reflow
            progressRingCircle.style.animation = 'ring-glow 1s ease-out';

            playNotificationSound();
        }

        // PLAY NOTIFICATION SOUND
        function playNotificationSound() {
            if (!timerState.soundEnabled) return;

            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gain = audioContext.createGain();

            oscillator.connect(gain);
            gain.connect(audioContext.destination);

            oscillator.frequency.value = 800;
            oscillator.type = 'sine';

            gain.gain.setValueAtTime(timerState.volume, audioContext.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // UPDATE SESSION LABEL
        function updateSessionLabel() {
            if (timerState.isLongBreak) {
                sessionLabel.textContent = 'Long Break';
            } else if (timerState.isBreak) {
                sessionLabel.textContent = 'Short Break';
            } else {
                sessionLabel.textContent = 'Focus Session';
            }
        }

        // UPDATE TOMATO COUNTER
        function updateTomatoCounter() {
            let counter = '';
            for (let i = 0; i < timerState.sessionsCompleted; i++) {
                counter += 'üçÖ';
            }
            tomatoCounter.textContent = counter || 'üçÖ';
        }

        // SHOW NOTIFICATION
        function showNotification(message) {
            if (!timerState.notificationsEnabled) return;

            notification.textContent = message;
            notification.style.display = 'block';
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // SHOW MODAL
        function showModal(title, message) {
            if (!timerState.notificationsEnabled) {
                if (timerState.autoStart) startTimer();
                return;
            }

            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMessage').textContent = message;
            modal.classList.add('show');
        }

        // HIDE MODAL
        function hideModal() {
            modal.classList.remove('show');
        }

        // SCENE SWITCHING
        function switchScene(sceneName) {
            const scenes = {
                rain: 'rainScene',
                forest: 'forestScene',
                ocean: 'oceanScene',
                cafe: 'cafeScene',
                space: 'spaceScene'
            };

            // Hide all scenes
            Object.values(scenes).forEach(sceneId => {
                document.getElementById(sceneId).classList.add('hidden');
            });

            // Show selected scene
            document.getElementById(scenes[sceneName]).classList.remove('hidden');
            timerState.currentScene = sceneName;

            // Update button states
            sceneButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.scene === sceneName);
            });
        }

        // SETTINGS PANEL
        function openSettings() {
            settingsPanel.classList.add('open');
        }

        function closeSettings() {
            settingsPanel.classList.remove('open');
        }

        function updateSettings() {
            timerState.focusDuration = parseInt(focusDurationInput.value);
            timerState.breakDuration = parseInt(breakDurationInput.value);
            timerState.longBreakDuration = parseInt(longBreakDurationInput.value);
            timerState.volume = parseInt(volumeSlider.value) / 100;

            // Reset timer with new durations if not running
            if (!timerState.isRunning) {
                if (!timerState.isBreak && !timerState.isLongBreak) {
                    timerState.timeLeft = timerState.focusDuration * 60;
                    timerState.totalTime = timerState.focusDuration * 60;
                }
                updateDisplay();
            }

            showNotification('Settings updated!');
        }

        // EVENT LISTENERS
        playPauseBtn.addEventListener('click', toggleTimer);
        resetBtn.addEventListener('click', resetTimer);
        settingsBtn.addEventListener('click', openSettings);
        closeSettingsBtn.addEventListener('click', closeSettings);

        sceneButtons.forEach(btn => {
            btn.addEventListener('click', () => switchScene(btn.dataset.scene));
        });

        focusDurationInput.addEventListener('change', updateSettings);
        breakDurationInput.addEventListener('change', updateSettings);
        longBreakDurationInput.addEventListener('change', updateSettings);

        volumeSlider.addEventListener('input', (e) => {
            timerState.volume = parseInt(e.target.value) / 100;
            volumeValue.textContent = e.target.value + '%';
        });

        autoStartToggle.addEventListener('click', () => {
            timerState.autoStart = !timerState.autoStart;
            autoStartToggle.querySelector('.toggle').classList.toggle('active');
        });

        notificationToggle.addEventListener('click', () => {
            timerState.notificationsEnabled = !timerState.notificationsEnabled;
            notificationToggle.querySelector('.toggle').classList.toggle('active');
        });

        soundToggle.addEventListener('click', () => {
            timerState.soundEnabled = !timerState.soundEnabled;
            soundToggle.querySelector('.toggle').classList.toggle('active');
        });

        document.getElementById('continueBtn').addEventListener('click', () => {
            hideModal();
            if (timerState.autoStart) {
                startTimer();
            }
        });

        document.getElementById('skipBtn').addEventListener('click', () => {
            hideModal();
            completeSession();
        });

        // Close settings when clicking outside
        document.addEventListener('click', (e) => {
            if (!settingsPanel.contains(e.target) && 
                !settingsBtn.contains(e.target) && 
                settingsPanel.classList.contains('open')) {
                closeSettings();
            }
        });

        // KEYBOARD SHORTCUTS
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                toggleTimer();
            }
            if (e.code === 'KeyR') {
                resetTimer();
            }
            if (e.code === 'KeyS') {
                openSettings();
            }
        });

        // INITIAL SETUP
        updateDisplay();
    </script>
</body>
</html>